

{% extends 'dicom_processor/base.html' %}

{% block title %}VTK Viewer | {{ series.name|default:"No Series" }}{% endblock %}

{% block content %}
    {# This block will hold the main content of our page #}
    <div class="container-fluid vh-100 d-flex flex-column p-2">

        {# --- TOP INFO BAR --- #}
        {# This shows information about the scan being viewed. #}
        <div class="row g-0 mb-2">
            <div class="col">
                <div class="d-flex justify-content-between px-3 py-2 bg-light border rounded align-items-center">
                    <div><strong>Series:</strong> {{ series.name|default:"N/A" }}</div>
                    <div><strong>Patient ID:</strong> {{ series.patient_id|default:"N/A" }}</div>
                    <div><strong>Age:</strong> {{ series.patient_age|default:"N/A" }}</div>
                    <div><strong>Gender:</strong> {{ series.patient_gender|default:"N/A" }}</div>
                </div>
            </div>
        </div>

        {# --- MAIN VIEWER AREA --- #}
        {# This 'flex-grow-1' makes the viewer area fill up all available vertical space. #}
        <div class="row g-2 flex-grow-1">

            {# --- The 4 Viewer Panels --- #}
            {# We create a 2x2 grid. Each column takes up half the width ('col-6') #}

            <!-- 3D RENDER VIEW (Top Left) -->
            <div class="col-6 d-flex">
                <div class="viewer-container">
                    <div class="viewer-header">3D Render View</div>
                    <div class="viewer-box" id="renderView">
                        {# This div is empty! VTK.js will take it over and draw the 3D scene inside. #}
                    </div>
                </div>
            </div>

            <!-- AXIAL VIEW (Top Right) -->
            <div class="col-6 d-flex">
                <div class="viewer-container">
                    <div class="viewer-header">Axial</div>
                    <div class="viewer-box" id="axialView">
                        {# This div is also empty, ready for VTK.js to draw the axial slice. #}
                    </div>
                </div>
            </div>

            <!-- SAGITTAL VIEW (Bottom Left) -->
            <div class="col-6 d-flex">
                <div class="viewer-container">
                    <div class="viewer-header">Sagittal</div>
                    <div class="viewer-box" id="sagittalView">
                        {# This div is empty, ready for the sagittal slice. #}
                    </div>
                </div>
            </div>

            <!-- CORONAL VIEW (Bottom Right) -->
            <div class="col-6 d-flex">
                <div class="viewer-container">
                    <div class="viewer-header">Coronal</div>
                    <div class="viewer-box" id="coronalView">
                        {# This div is empty, ready for the coronal slice. #}
                    </div>
                </div>
            </div>
        </div>

        {# --- LOADING OVERLAY --- #}
        {# A message that we can show while the 3D data is loading. #}
        <div id="loadingOverlay">
            <div class="spinner-border text-light" role="status"></div>
            <p class="mt-2 text-light">Loading 3D Data...</p>
        </div>

    </div>
{% endblock %}


{% block styles %}
{# This is a special Django block where we can add CSS styling. #}
<style>
    /* Why this style? To make our viewer look clean and professional. */
    
    /* Make the main content take up the full browser window height */
    .vh-100 {
        height: 100vh;
    }

    /* The container for each of the 4 views */
    .viewer-container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        background-color: #343a40; /* A dark background color */
        border: 1px solid #495057;
        border-radius: 0.25rem;
    }

    /* The header for each view (e.g., "Axial") */
    .viewer-header {
        text-align: center;
        color: #f8f9fa; /* Light text color */
        padding: 4px;
        background-color: #495057; /* A slightly lighter dark color for the header */
        font-size: 0.9em;
        font-weight: bold;
    }

    /* The main box where VTK.js will draw the 3D scene or slice */
    .viewer-box {
        flex-grow: 1; /* This makes the box fill all available space in its container */
        position: relative; /* Needed for positioning things inside later */
        overflow: hidden; /* Hides anything that might accidentally stick out */
        min-height: 200px; /* Ensures the box has a minimum size */
    }

    /* This is a screen that can cover the whole page while data is loading */
    #loadingOverlay {
        position: fixed; /* Stays in one place even if you scroll */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.75); /* Black with 75% transparency */
        display: none; /* It's hidden by default! We'll show it with JavaScript. */
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 1000; /* Makes sure it's on top of everything else */
    }
</style>
{% endblock %}


{% block scripts %}
    {# This is the Django block where we add our JavaScript libraries. #}
    {{ block.super }} {# This keeps scripts from base.html (like Bootstrap) #}

    {# This is the most important line! It loads the entire VTK.js library from the internet. #}
    <script type="text/javascript" src="https://unpkg.com/vtk.js@29"></script>

    {# This is where OUR OWN JavaScript will go in the next step! #}
    {# We will write the code here to load the data and tell VTK.js to draw in our viewer boxes. #}
    <script>
        // Our JavaScript adventure starts here next...
    </script>
{% endblock %}
